# R Description

## Learning Objectives

In this chapter, you will learn how to:

- Make a professional quality table of descriptive statistics

## Set-up

To complete this chapter, you need to

- Start a notebook
- Load the following packages

```{r, eval=FALSE}
library(tidyverse)
library(arsenal)
library(knitr)
library(carData)
```

## Introduction

Summary statistics tables are ubiquitous in reports and studies. Usually a project involves numerous variables that would require too many visualizations to summarize, though we should still consider visualizations for the most important variables. A standard summary stats table provides readers a reference for key measures pertaining to all our variables in a fairly compact form. They can even provide new insights in lieu of a visualization.

In this chapter, we set out to summarize variables within the `States` dataset of the `carData` package.

```{block, type='learncheck', purl=FALSE}
**Exercise 1:**  Use the `glimpse` function to examine the `States` dataset.
```

```{r, include=FALSE}
glimpse(States)
```

`States` is a cross-section of the 50 states and D.C. containing education and related statistics. Be sure to read the help page for `States` to understand each variable. You can do that by typing `States` in the search bar of the bottom-right pane of RStudio or going to the `carData` package under the Packages tab and clicking on the `States` link.

## Summary Table

Summary tables come in many styles, so there is no way to cover everything. In most cases, a summary table includes the following descriptive measures depending on the type of variable:

- Numerical variables
  - Mean
  - Standard deviation
  - Minimum
  - Maximum
- Categorical variables
  - Counts for each level, and/or
  - Percentages for each level

If a variable is skewed, then it may be wise to replace the mean and standard deviation with the median, first quartile, and third quartile. We will learn how to do this.

## Using Arsenal

Due to the many styles of summary tables, there are numerous R packages designed to produce summary tables. The best R package in terms of quickly getting the information to a nicely formatted table of which I am aware is Arsenal. Therefore, we will learn how to use Arsenal. I will demonstrate Arsenal using the `gapminder` data with which we are all familiar. Then, I will ask you to replicate those demonstrations using the `States` data.

Producing a summary table with Arsenal involves at least two, probably three, steps.

- Create a new object containing the summary statistics we want to include in a table
- Relabel the variables to something appropriate for our audience
- Generating the summary table based on the new object we just created

Here is an example using `gapminder` data without altering any of Aresenal's default options that we will want to know how to alter in most cases.

```{r, results='hide'}
sum.gapminder <- tableby(~ continent + gdpPercap + lifeExp + pop, data = gapminder)

labels(sum.gapminder) <- c(continent = "Continent", gdpPercap = "GDP Per Capita", lifeExp = "Life Expectancy", pop = "Population")
```

```{r, results='asis'}
summary(sum.gapminder, title = "Summary Stats for Gapminder Data")
```

The second code chunk above requires a specific code chunk option in order for the table to print correctly. The top line of a code chunk includes `{r}` by default. To print the summary table from the Arsenal package correctly using the `summary()` function, we need to add the code chunk option `results='asis'`. Therefore, the top line of the code chunk should be `{r, results='asis'}`.

```{block, type='learncheck', purl=FALSE}
**Exercise 2:**  Replicate the code shown above to create a default summary table for the `States` data using the Arsenal package. Be sure to relabel the variables to something relatively understandable and brief. Labeling is tedious but you only need to do it once. You can run the code individually or knit your notebook to preview the table.
```

In three relatively short bits of code, we already have a decent summary table that would have taken excruciatingly long to input manually. But it can be made better.

### Adjustments

#### Decimal digits {-}

The biggest aesthetic issue with this table is including so many decimals. None of these variables have such a small range that rounding to integers masks useful information. Obviously, if a variable only ranges between 0 and 1, we would not want to round to an integer.

Specifying the number of decimals is quite easy with Arsenal. Because arsenal tries to be as flexible as possible, we have to specify the number of decimals separately for numerical and percentage measures. The following code sets the number of decimals to zero for the gapminder data.

```{r}
sum.gapminder2 <- tableby(~ continent + gdpPercap + lifeExp + pop, data = gapminder, digits = 0, digits.pct = 0)

labels(sum.gapminder2) <- c(continent = "Continent", gdpPercap = "GDP Per Capita", lifeExp = "Life Expectancy", pop = "Population")
```

```{r, results='asis'}
summary(sum.gapminder2, title = "Summary Stats for Gapminder Data")
```

```{block, type='learncheck', purl=FALSE}
**Exercise 3:**  Replicate the code shown above to create a  summary table for the `States` data with no decimals. You will need to copy-and-paste the labels code.
```

#### Reporting median and IQR {-}

Instead of the mean and standard deviation, we may want to report the median, first quartile, and third quartile for our numerical variables. We can control the descriptive measures using the following code.

```{r}
sum.gapminder3 <- tableby(~ continent + gdpPercap + lifeExp + pop, data = gapminder, digits = 0, digits.pct = 0, numeric.stats = c("median", "q1q3", "range"))

labels(sum.gapminder3) <- c(continent = "Continent", gdpPercap = "GDP Per Capita", lifeExp = "Life Expectancy", pop = "Population")
```

```{r, results='asis'}
summary(sum.gapminder3, title = "Summary Stats for Gapminder Data")
```

```{block, type='learncheck', purl=FALSE}
**Exercise 4:**  Replicate the code shown above to create a  summary table for the `States` data that reports median and the first and third quartiles.
```

#### Across groups {-}

Finally, instead of reporting summary statistics for the entire sample, we may want to report them separately for each level of a categorical variable. This is a common way to make comparisons.

We can have Arsenal report across groups by adding the categorical variable to the left side of the formula in the `tableby` code. The code below reports the `gapminder` data across continents. By default, Arsenal tests for correlations across groups and reports a p-value. This is not a common part of a summary table, so I turn this feature off with the `test = FALSE` within the code below.

```{r}
sum.gapminder4 <- tableby(continent ~ gdpPercap + lifeExp + pop, data = gapminder, digits = 0, digits.pct = 0, test = FALSE)

labels(sum.gapminder4) <- c(continent = "Continent", gdpPercap = "GDP Per Capita", lifeExp = "Life Expectancy", pop = "Population")
```

```{r, results='asis'}
summary(sum.gapminder4, title = "Summary Stats for Gapminder Data")
```

```{block, type='learncheck', purl=FALSE}
**Exercise 5:**  Replicate the code shown above to create a  summary table for the `States` data that reports across regions.
```

### Export to CSV

Knitting your notebook to HTML, Word, or PDF should produce a summary table in the appropriate format. Depending on our or others' workflow, we may want to export our summary table to CSV in order to easily open in Excel or other spreadsheet software. Arsenal can easily handle this.

To export my `gapminder` summary to CSV, I need to create a new object that contains the actual summary table. Below, I save the last summary to the object named `sum.table`.

```{r, eval=FALSE}
sum.table <- summary(sum.gapminder4, title = "Summary Stats for Gapminder Data")
```

Next, I need to convert this table into a data frame using the `as.data.frame()` function like so.

```{r, eval=FALSE}
sum.table <- as.data.frame(sum.table)
```

Lastly, I just need to save this data frame as a CSV file using the `write.csv()` function like so.

```{r, eval=FALSE}
write.csv(sum.table, file = "sumtable.csv")
```

R will save the CSV file to my project folder. Otherwise, R will save the file to my current working directory.

## Submit

Arsenal has many more options. The help page and links to tutorials can help you generate various types of summary tables.

Submit your notebook to eLC.